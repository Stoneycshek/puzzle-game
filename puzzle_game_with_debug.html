<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çŠçŠçš„å°‹å¯¶éŠæˆ² - èª¿è©¦ç‰ˆæœ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            touch-action: pan-y;
            overflow-x: hidden;
        }

        body.debug-mode {
            touch-action: none;
        }

        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 100%;
            margin: 0 auto;
            background: white;
        }

        .header {
            background: linear-gradient(135deg, #ff6b9d 0%, #ffa06f 100%);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .debug-buttons {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }

        .debug-toggle, .export-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid white;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.7em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .debug-toggle:active, .export-btn:active {
            background: rgba(255, 255, 255, 0.5);
        }

        .debug-toggle.active {
            background: #4CAF50;
        }

        .export-btn {
            background: rgba(255, 152, 0, 0.8);
        }

        .game-view {
            flex: 1;
            position: relative;
            background: #f5f5f5;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .scene {
            display: none;
            width: 100%;
            flex: 1;
            position: relative;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 500px;
            height: calc(100vh - 280px);
        }

        .scene.active {
            display: flex;
            flex-direction: column;
        }

        .scene-content {
            flex: 1;
            position: relative;
            min-height: 300px;
        }

        .living-room-bg {
            background-image: url('gameArt/living-room.png');
        }

        .kitchen-bg {
            background-image: url('gameArt/kitchen.png');
        }

        .bedroom-bg {
            background-image: url('gameArt/bedroom.png');
        }

        .study-bg {
            background-image: url('gameArt/study.png');
        }

        .clickable-item {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            color: transparent;
            user-select: none;
        }

        .clickable-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border: 2px dashed rgba(255, 255, 255, 0.6);
        }

        /* Debug mode styles */
        body.debug-mode .clickable-item {
            background: rgba(255, 0, 0, 0.2) !important;
            border: 2px dashed rgba(255, 0, 0, 0.6) !important;
            color: red !important;
            font-weight: bold;
            font-size: 0.7em;
            text-shadow: 1px 1px 2px white;
            touch-action: none;
            cursor: move;
        }

        body.debug-mode .clickable-item:hover {
            background: rgba(255, 100, 0, 0.3) !important;
            border: 2px solid rgba(255, 100, 0, 0.8) !important;
        }

        body.debug-mode .clickable-item.dragging {
            background: rgba(0, 255, 0, 0.4) !important;
            border: 3px solid rgba(0, 255, 0, 0.9) !important;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.6) !important;
            z-index: 1000;
            transition: none;
        }

        /* Resize handles */
        .clickable-item .resize-handle {
            display: none;
            position: absolute;
            width: 20px;
            height: 20px;
            background: #4CAF50;
            border: 2px solid white;
            border-radius: 50%;
            cursor: nwse-resize;
            z-index: 10;
        }

        body.debug-mode .clickable-item .resize-handle {
            display: block;
        }

        .resize-handle.bottom-right {
            bottom: -10px;
            right: -10px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-btn:active {
            background: #5568d3;
        }
        
        .view-item-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
        }

        .view-item-btn:active {
            background: #2980b9;
        }

        .view-item-btn:disabled {
            background: #7f8c8d;
            opacity: 0.5;
        }

        .scene-description {
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            margin: 10px;
            border-radius: 20px;
            text-align: center;
            font-size: 0.85em;
            color: white;
            backdrop-filter: blur(5px);
        }

        .notification {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            z-index: 2001;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            max-width: 80%;
            text-align: center;
        }

        .notification.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .debug-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #4CAF50;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 0.7em;
            max-width: 300px;
            max-height: 50vh;
            overflow-y: auto;
            z-index: 3000;
            display: none;
        }

        body.debug-mode .debug-info {
            display: block;
        }

        .debug-info div {
            margin: 3px 0;
        }

        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .export-modal.active {
            display: flex;
        }

        .export-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .export-content h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .export-content textarea {
            width: 100%;
            height: 300px;
            font-family: monospace;
            font-size: 0.8em;
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 5px;
            resize: vertical;
        }

        .export-content button {
            margin-top: 10px;
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            margin-right: 10px;
        }

        .export-content button.close {
            background: #f44336;
        }

        .inventory {
            background: #2c3e50;
            padding: 15px;
            min-height: 120px;
        }

        .inventory-header {
            color: white;
            font-size: 0.9em;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inventory-items {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            align-items: center;
        }

        .inventory-item {
            min-width: 70px;
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            flex-shrink: 0;
            border: 3px solid transparent;
        }

        @media (max-width: 768px) {
            .scene {
                min-height: 450px;
                height: calc(100vh - 250px);
            }

            .clickable-item {
                min-width: 80px;
                min-height: 80px;
            }

            .header h1 {
                font-size: 1.3em;
            }

            .header p {
                font-size: 0.85em;
            }

            .debug-info {
                font-size: 0.6em;
                max-width: 45%;
                bottom: 10px;
                left: 10px;
            }

            .export-content {
                padding: 15px;
            }

            .export-content textarea {
                height: 200px;
                font-size: 0.7em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <div class="debug-buttons">
                <button class="debug-toggle" id="debug-toggle" onclick="toggleDebugMode()">èª¿è©¦</button>
                <button class="export-btn" id="export-btn" onclick="exportCode()">åŒ¯å‡º</button>
            </div>
            <h1>çŠçŠçš„å°‹å¯¶éŠæˆ²</h1>
            <p>æ‰¾å‡ºè±¬è±¬ç•™ä¸‹çš„ç¥ç§˜ç›’å­å¯†ç¢¼</p>
        </div>

        <div class="notification" id="notification"></div>

        <div class="game-view">
            <!-- Living Room Scene -->
            <div class="scene active living-room-bg" id="living-room">
                <div class="scene-description">å®¢å»³ - æ¡Œä¸Šæœ‰ä¸€å€‹ä¸Šé–çš„ç¥ç§˜ç›’å­</div>
                <div class="scene-content">
                    <div class="clickable-item" id="mystery-box" data-name="ç¥ç§˜ç›’å­"
                         style="top: 48.58%; left: 34.81%; width: 62.0952px; height: 62.2857px;">
                        ç›’å­<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="bookshelf" data-name="æ›¸æ¶"
                         style="top: 23.48%; left: 0.85%; width: 89.7143px; height: 163.429px;">
                        æ›¸æ¶<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="tv-cabinet" data-name="é›»è¦–æ«ƒ"
                         style="top: 39.84%; right: 5.84%; width: 107.048px; height: 54.1905px;">
                        é›»è¦–æ«ƒ<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="tv-screen" data-name="é›»è¦–"
                         style="top: 27.45%; right: 8.3%; width: 82.8571px; height: 79.0476px;">
                        é›»è¦–<div class="resize-handle bottom-right"></div>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeScene('bedroom')">å‰å¾€è‡¥å®¤</button>
                    <button class="nav-btn" onclick="changeScene('kitchen')">å‰å¾€å»šæˆ¿</button>
                </div>
            </div>

            <!-- Bedroom Scene -->
            <div class="scene bedroom-bg" id="bedroom">
                <div class="scene-description">è‡¥å®¤ - æº«é¦¨çš„æˆ¿é–“,å……æ»¿ä½ å€‘çš„å›æ†¶</div>
                <div class="scene-content">
                    <div class="clickable-item" id="wardrobe" data-name="è¡£æ«ƒ"
                         style="top: 25%; left: 2.1%; width: 85.3333px; height: 155.619px;">
                        è¡£æ«ƒ<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="bedside-table" data-name="åºŠé ­æ«ƒ"
                         style="top: 46.81%; right: -0.97%; width: 55.1905px; height: 84.5237px;">
                        åºŠé ­æ«ƒ<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="photo-frame" data-name="ç›¸æ¡†"
                         style="top: 28.57%; right: 14.13%; width: 54.4286px; height: 67.5714px;">
                        ç›¸æ¡†<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="pillow" data-name="æ•é ­"
                         style="top: 41.94%; left: 47.94%; width: 84.5714px; height: 51.4762px;">
                        æ•é ­<div class="resize-handle bottom-right"></div>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeScene('living-room')">å›åˆ°å®¢å»³</button>
                    <button class="nav-btn" onclick="changeScene('study')">å‰å¾€æ›¸æˆ¿</button>
                </div>
            </div>

            <!-- Study Room Scene -->
            <div class="scene study-bg" id="study">
                <div class="scene-description">æ›¸æˆ¿ - è±¬è±¬çš„å·¥ä½œç©ºé–“</div>
                <div class="scene-content">
                    <div class="clickable-item" id="computer" data-name="é›»è…¦"
                         style="top: 37.89%; left: 46.46%; width: 84.0476px; height: 90.4286px;">
                        é›»è…¦<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="desk-drawer" data-name="æŠ½å±œ"
                         style="top: 53.57%; right: 21.78%; width: 50px; height: 78.619px;">
                        æŠ½å±œ<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="bookcase" data-name="æ›¸æ«ƒ"
                         style="top: 24.1%; left: 1.3%; width: 88.6667px; height: 177.429px;">
                        æ›¸æ«ƒ<div class="resize-handle bottom-right"></div>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeScene('bedroom')">å›åˆ°è‡¥å®¤</button>
                </div>
            </div>

            <!-- Kitchen Scene -->
            <div class="scene kitchen-bg" id="kitchen">
                <div class="scene-description">å»šæˆ¿ - é€™è£¡æœ‰çŠçŠæœ€æ„›çš„èŒ¶è‘‰è§’è½</div>
                <div class="scene-content">
                    <div class="clickable-item" id="fridge" data-name="å†°ç®±"
                         style="top: 30.33%; left: 1.74%; width: 84.3334px; height: 184.667px;">
                        å†°ç®±<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="safe" data-name="ä¿éšªç®±"
                         style="top: 30.66%; right: 7.86%; bottom: 30%; width: 60.8571px; height: 77.5238px;">
                        ä¿éšªç®±<div class="resize-handle bottom-right"></div>
                    </div>
                    <div class="clickable-item" id="kitchen-cabinet" data-name="å»šæ«ƒ"
                         style="top: 50.65%; right: 2.46%; width: 159.048px; height: 118.619px;">
                        å»šæ«ƒ<div class="resize-handle bottom-right"></div>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeScene('living-room')">å›åˆ°å®¢å»³</button>
                </div>
            </div>
        </div>

        <div class="inventory">
            <div class="inventory-header">
                <span>èƒŒåŒ… (é»æ“Šç‰©å“é¸æ“‡/å–æ¶ˆ)</span>
                <button class="view-item-btn" id="view-item-btn" onclick="viewSelectedItem()" disabled>æŸ¥çœ‹è©³æƒ…</button>
            </div>
            <div class="inventory-items" id="inventory-items">
                <!-- Items will be added here -->
            </div>
        </div>
    </div>

    <!-- Debug Info Panel -->
    <div class="debug-info" id="debug-info">
        <div style="color: #fff; font-weight: bold; margin-bottom: 10px;">ğŸ“ èª¿è©¦è³‡è¨Š</div>
        <div>æ‹–å‹•ç‰©å“èª¿æ•´ä½ç½®</div>
        <div>å³ä¸‹è§’åœ“é»èª¿æ•´å¤§å°</div>
        <div id="debug-output"></div>
    </div>

    <!-- Export Modal -->
    <div class="export-modal" id="export-modal">
        <div class="export-content">
            <h2>ğŸ“‹ åŒ¯å‡ºä»£ç¢¼</h2>
            <p style="margin-bottom: 10px; color: #666;">è¤‡è£½ä»¥ä¸‹ä»£ç¢¼,ç”¨æ–¼æ›´æ–° puzzle_game.html</p>
            <textarea id="export-code" readonly></textarea>
            <br>
            <button onclick="copyCode()">è¤‡è£½ä»£ç¢¼</button>
            <button class="close" onclick="closeExportModal()">é—œé–‰</button>
        </div>
    </div>

    <script>
        let debugMode = false;
        let dragging = null;
        let resizing = null;
        let startX, startY, startLeft, startTop, startWidth, startHeight;

        function toggleDebugMode() {
            debugMode = !debugMode;
            document.body.classList.toggle('debug-mode', debugMode);
            const btn = document.getElementById('debug-toggle');
            btn.classList.toggle('active', debugMode);
            btn.textContent = debugMode ? 'èª¿è©¦ä¸­' : 'èª¿è©¦';

            if (debugMode) {
                showNotification('æ‹–å‹•ç‰©å“èª¿æ•´ä½ç½® | å³ä¸‹è§’èª¿æ•´å¤§å°');
            } else {
                showNotification('èª¿è©¦æ¨¡å¼å·²é—œé–‰');
            }
        }

        function changeScene(sceneName) {
            document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
            document.getElementById(sceneName).classList.add('active');
        }

        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.classList.add('show');
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        // Dragging functionality
        document.querySelectorAll('.clickable-item').forEach(item => {
            // Main drag
            item.addEventListener('mousedown', startDrag);
            item.addEventListener('touchstart', startDrag);

            // Resize handle
            const handle = item.querySelector('.resize-handle');
            if (handle) {
                handle.addEventListener('mousedown', startResize);
                handle.addEventListener('touchstart', startResize);
            }
        });

        function startDrag(e) {
            if (!debugMode) return;
            if (e.target.classList.contains('resize-handle')) return;

            e.preventDefault();
            e.stopPropagation();

            dragging = this;
            dragging.classList.add('dragging');

            const touch = e.touches ? e.touches[0] : e;
            startX = touch.clientX;
            startY = touch.clientY;

            const rect = dragging.getBoundingClientRect();
            startLeft = rect.left;
            startTop = rect.top;

            updateDebugInfo(dragging);
        }

        function startResize(e) {
            if (!debugMode) return;

            e.preventDefault();
            e.stopPropagation();

            resizing = this.parentElement;
            resizing.classList.add('dragging');

            const touch = e.touches ? e.touches[0] : e;
            startX = touch.clientX;
            startY = touch.clientY;

            startWidth = resizing.offsetWidth;
            startHeight = resizing.offsetHeight;

            updateDebugInfo(resizing);
        }

        document.addEventListener('mousemove', handleMove);
        document.addEventListener('touchmove', handleMove);

        document.addEventListener('mouseup', stopDragOrResize);
        document.addEventListener('touchend', stopDragOrResize);

        function handleMove(e) {
            if (!dragging && !resizing) return;

            e.preventDefault();
            const touch = e.touches ? e.touches[0] : e;

            if (dragging) {
                const dx = touch.clientX - startX;
                const dy = touch.clientY - startY;

                const parent = dragging.parentElement.getBoundingClientRect();
                const newLeft = startLeft + dx - parent.left;
                const newTop = startTop + dy - parent.top;

                // Calculate percentage
                const leftPercent = (newLeft / parent.width * 100).toFixed(2);
                const topPercent = (newTop / parent.height * 100).toFixed(2);

                // Check if using right or left positioning
                const hasRight = dragging.style.right && dragging.style.right !== 'auto';
                const hasTransform = dragging.style.transform.includes('translateX');

                if (hasTransform) {
                    // Keep centered
                    dragging.style.top = topPercent + '%';
                    dragging.style.left = '50%';
                } else if (hasRight) {
                    const rightPercent = (100 - leftPercent - (dragging.offsetWidth / parent.width * 100)).toFixed(2);
                    dragging.style.top = topPercent + '%';
                    dragging.style.right = rightPercent + '%';
                } else {
                    dragging.style.left = leftPercent + '%';
                    dragging.style.top = topPercent + '%';
                }

                updateDebugInfo(dragging);
            } else if (resizing) {
                const dx = touch.clientX - startX;
                const dy = touch.clientY - startY;

                const newWidth = Math.max(50, startWidth + dx);
                const newHeight = Math.max(50, startHeight + dy);

                resizing.style.width = newWidth + 'px';
                resizing.style.height = newHeight + 'px';

                updateDebugInfo(resizing);
            }
        }

        function stopDragOrResize() {
            if (dragging) {
                dragging.classList.remove('dragging');
                showNotification('å·²æ›´æ–°: ' + dragging.getAttribute('data-name'));
                dragging = null;
            }
            if (resizing) {
                resizing.classList.remove('dragging');
                showNotification('å·²èª¿æ•´å¤§å°: ' + resizing.getAttribute('data-name'));
                resizing = null;
            }
        }

        function updateDebugInfo(item) {
            const name = item.getAttribute('data-name');
            const id = item.id;
            const style = item.style;

            const debugOutput = document.getElementById('debug-output');
            debugOutput.innerHTML = `
                <div style="color: #ffa500; margin-top: 10px; font-weight: bold;">
                    ${name} (#${id})
                </div>
                <div>top: ${style.top || 'auto'}</div>
                <div>left: ${style.left || 'auto'}</div>
                <div>right: ${style.right || 'auto'}</div>
                <div>bottom: ${style.bottom || 'auto'}</div>
                <div>width: ${style.width}</div>
                <div>height: ${style.height}</div>
                ${style.transform ? `<div>transform: ${style.transform}</div>` : ''}
            `;
        }

        function exportCode() {
            const scenes = ['living-room', 'bedroom', 'study', 'kitchen'];
            let code = '/* è¤‡è£½ä»¥ä¸‹ä»£ç¢¼åˆ° puzzle_game.html å°æ‡‰çš„ä½ç½® */\n\n';

            scenes.forEach(sceneId => {
                const scene = document.getElementById(sceneId);
                const sceneNameMap = {
                    'living-room': 'å®¢å»³',
                    'bedroom': 'è‡¥å®¤',
                    'study': 'æ›¸æˆ¿',
                    'kitchen': 'å»šæˆ¿'
                };

                code += `<!-- ${sceneNameMap[sceneId]} Scene -->\n`;

                const items = scene.querySelectorAll('.clickable-item');
                items.forEach(item => {
                    const id = item.id;
                    const name = item.getAttribute('data-name');
                    const style = item.style;

                    let styleStr = '';
                    if (style.top) styleStr += `top: ${style.top}; `;
                    if (style.left) styleStr += `left: ${style.left}; `;
                    if (style.right) styleStr += `right: ${style.right}; `;
                    if (style.bottom) styleStr += `bottom: ${style.bottom}; `;
                    if (style.width) styleStr += `width: ${style.width}; `;
                    if (style.height) styleStr += `height: ${style.height}; `;
                    if (style.transform) styleStr += `transform: ${style.transform}; `;

                    code += `<div class="clickable-item" id="${id}" style="${styleStr.trim()}"></div> <!-- ${name} -->\n`;
                });

                code += '\n';
            });

            document.getElementById('export-code').value = code;
            document.getElementById('export-modal').classList.add('active');
        }

        function copyCode() {
            const textarea = document.getElementById('export-code');
            textarea.select();
            document.execCommand('copy');
            showNotification('ä»£ç¢¼å·²è¤‡è£½åˆ°å‰ªè²¼æ¿!');
        }

        function closeExportModal() {
            document.getElementById('export-modal').classList.remove('active');
        }

        console.log('èª¿è©¦å·¥å…·å·²è¼‰å…¥ | çª—å£å°ºå¯¸:', window.innerWidth, 'x', window.innerHeight);
    </script>
</body>
</html>
