<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çŠçŠçš„å°‹å¯¶éŠæˆ² - è±¬è±¬çš„ç¥ç§˜ç¦®ç‰©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            touch-action: pan-y;
            overflow-x: hidden;
        }

        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 100%;
            margin: 0 auto;
            background: white;
        }

        .header {
            background: linear-gradient(135deg, #ff6b9d 0%, #ffa06f 100%);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .game-view {
            flex: 1;
            position: relative;
            background: #f5f5f5;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .scene {
            display: none;
            width: 100%;
            flex: 1;
            position: relative;
            background-size: cover;
            background-position: center;
            min-height: 400px;
        }

        .scene.active {
            display: flex;
            flex-direction: column;
        }

        .scene-content {
            flex: 1;
            position: relative;
            min-height: 300px;
        }

        .living-room-bg {
            background:
                linear-gradient(135deg, rgba(227, 242, 253, 0.9) 0%, rgba(187, 222, 251, 0.9) 100%),
                repeating-linear-gradient(90deg, #e3f2fd 0px, #e3f2fd 2px, #bbdefb 2px, #bbdefb 4px);
            box-shadow: inset 0 0 100px rgba(100, 181, 246, 0.3);
        }

        .kitchen-bg {
            background:
                linear-gradient(135deg, rgba(255, 243, 224, 0.9) 0%, rgba(255, 224, 178, 0.9) 100%),
                repeating-linear-gradient(45deg, #fff3e0 0px, #fff3e0 10px, #ffe0b2 10px, #ffe0b2 20px);
            box-shadow: inset 0 0 100px rgba(255, 183, 77, 0.2);
        }

        .bedroom-bg {
            background:
                linear-gradient(135deg, rgba(248, 187, 208, 0.9) 0%, rgba(252, 219, 238, 0.9) 100%),
                repeating-linear-gradient(0deg, #f8bbd0 0px, #f8bbd0 3px, #fcdbed 3px, #fcdbed 6px);
            box-shadow: inset 0 0 100px rgba(233, 30, 99, 0.15);
        }

        .study-bg {
            background:
                linear-gradient(135deg, rgba(209, 196, 233, 0.9) 0%, rgba(179, 157, 219, 0.9) 100%),
                repeating-linear-gradient(90deg, #d1c4e9 0px, #d1c4e9 4px, #b39ddb 4px, #b39ddb 8px);
            box-shadow: inset 0 0 100px rgba(103, 58, 183, 0.2);
        }

        /* Add texture and depth to scenes */
        .scene-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 30% 40%, rgba(255, 255, 255, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 70% 60%, rgba(0, 0, 0, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .clickable-item {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .clickable-item:active {
            transform: scale(0.95);
        }

        .clickable-item.highlight {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            justify-content: center;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-btn:active {
            background: #5568d3;
        }

        .inventory {
            background: #2c3e50;
            padding: 15px;
            min-height: 120px;
        }

        .inventory-header {
            color: white;
            font-size: 0.9em;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inventory-items {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            align-items: center;
        }

        .view-item-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
        }

        .view-item-btn:active {
            background: #2980b9;
        }

        .view-item-btn:disabled {
            background: #7f8c8d;
            opacity: 0.5;
        }

        .inventory-item {
            min-width: 70px;
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .inventory-item:active {
            transform: scale(0.9);
        }

        .inventory-item.selected {
            border-color: #ff6b9d;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
            position: relative;
        }

        .modal-content h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .modal-content p {
            line-height: 1.6;
            margin-bottom: 20px;
            color: #333;
        }

        .close-btn {
            background: #ff6b9d;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 10px;
        }

        .password-input {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .password-input input {
            width: 40px;
            height: 50px;
            text-align: center;
            font-size: 1.5em;
            border: 2px solid #667eea;
            border-radius: 8px;
        }

        .submit-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
        }

        .scene-description {
            background: rgba(255,255,255,0.95);
            padding: 15px;
            margin: 10px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9em;
            color: #333;
        }

        .item-visual {
            width: 100%;
            height: 150px;
            background: #f0f0f0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            margin-bottom: 15px;
        }

        .victory {
            text-align: center;
        }

        .victory h1 {
            color: #ff6b9d;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .birthday-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .birthday-card h2 {
            color: #d84315;
            margin-bottom: 15px;
        }

        .birthday-card p {
            color: #333;
            line-height: 1.8;
            font-size: 1.1em;
        }

        .hint-text {
            font-size: 0.85em;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }

        .notification {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            z-index: 2001;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .notification.error {
            background: #f44336;
        }

        .notification.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }

        .intro-screen.hidden {
            display: none;
        }

        .intro-content {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        .intro-content h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .intro-content .story {
            color: #333;
            line-height: 1.8;
            margin-bottom: 30px;
            font-size: 1.05em;
        }

        .intro-content .emoji-scene {
            font-size: 3em;
            margin: 20px 0;
        }

        .start-game-btn {
            background: linear-gradient(135deg, #ff6b9d 0%, #ffa06f 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .start-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 157, 0.5);
        }

        .start-game-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- Intro Screen -->
    <div class="intro-screen" id="intro-screen">
        <div class="intro-content">
            <h1>çŠçŠçš„å°‹å¯¶éŠæˆ²</h1>
            <div class="emoji-scene">ğŸ ğŸ’•ğŸ</div>
            <div class="story">
                <p>æ—©æ™¨çš„é™½å…‰é€éçª—ç°¾ç‘é€²æˆ¿é–“...</p>
                <p style="margin-top: 15px;">
                    çŠçŠçœé–‹çœ¼ç›,ç™¼ç¾èº«æ—çš„è±¬è±¬å·²ç¶“å‡ºé–€ä¸Šç­äº†ã€‚
                </p>
                <p style="margin-top: 15px;">
                    åœ¨åºŠé ­æ«ƒä¸Š,æœ‰ä¸€å€‹ç²¾ç¾çš„ç›’å­,ä¸Šé¢è²¼è‘—ä¸€å¼µä¾¿æ¢:
                </p>
                <p style="margin-top: 15px; color: #ff6b9d; font-style: italic; font-weight: bold;">
                    "è¦ªæ„›çš„,ç”Ÿæ—¥å¿«æ¨‚!<br>
                    é€™å€‹ç›’å­è£¡æœ‰æˆ‘ç‚ºå¦³æº–å‚™çš„é©šå–œ,<br>
                    å¯†ç¢¼å°±è—åœ¨æˆ‘å€‘çš„å›æ†¶ä¸­...<br>
                    åŠ æ²¹,æˆ‘çŸ¥é“å¦³ä¸€å®šæ‰¾å¾—åˆ°! ğŸ’•"
                </p>
                <p style="margin-top: 20px; font-size: 0.95em; color: #666;">
                    å°‹æ‰¾ç·šç´¢,è§£é–‹6ä½æ•¸å­—å¯†ç¢¼,<br>
                    æ‰“é–‹è±¬è±¬ç•™ä¸‹çš„ç¥ç§˜ç›’å­å§!
                </p>
            </div>
            <button class="start-game-btn" onclick="startGame()">é–‹å§‹éŠæˆ² ğŸ®</button>
        </div>
    </div>

    <div class="game-container">
        <div class="header">
            <h1>çŠçŠçš„å°‹å¯¶éŠæˆ²</h1>
            <p>æ‰¾å‡ºè±¬è±¬ç•™ä¸‹çš„ç¥ç§˜ç›’å­å¯†ç¢¼</p>
        </div>

        <div class="notification" id="notification"></div>

        <div class="game-view">
            <!-- Living Room Scene -->
            <div class="scene active living-room-bg" id="living-room">
                <div class="scene-description">
                    å®¢å»³ - æ¡Œä¸Šæœ‰ä¸€å€‹ä¸Šé–çš„ç¥ç§˜ç›’å­
                </div>
                <div class="scene-content">
                    <div class="clickable-item" id="mystery-box" style="top: 15%; left: 50%; transform: translateX(-50%); font-size: 5em;">
                        ğŸ“¦
                    </div>
                    <div class="clickable-item highlight" id="bookshelf" style="top: 45%; left: 15%; font-size: 4em;">
                        ğŸ“š
                    </div>
                    <div class="clickable-item" id="tv-cabinet" style="top: 50%; right: 15%; font-size: 4em;">
                        ğŸ“º
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeScene('bedroom')">å‰å¾€è‡¥å®¤</button>
                    <button class="nav-btn" onclick="changeScene('kitchen')">å‰å¾€å»šæˆ¿</button>
                </div>
            </div>

            <!-- Bedroom Scene -->
            <div class="scene bedroom-bg" id="bedroom">
                <div class="scene-description">
                    è‡¥å®¤ - æº«é¦¨çš„æˆ¿é–“,å……æ»¿ä½ å€‘çš„å›æ†¶
                </div>
                <div class="scene-content">
                    <div class="clickable-item" id="wardrobe" style="top: 30%; left: 20%; font-size: 4em;">
                        ğŸšª
                    </div>
                    <div class="clickable-item" id="bedside-table" style="top: 35%; right: 20%; font-size: 3.5em;">
                        ğŸ›ï¸
                    </div>
                    <div class="clickable-item" id="photo-frame" style="top: 60%; left: 50%; transform: translateX(-50%); font-size: 3.5em;">
                        ğŸ–¼ï¸
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeScene('living-room')">å›åˆ°å®¢å»³</button>
                    <button class="nav-btn" onclick="changeScene('study')">å‰å¾€æ›¸æˆ¿</button>
                </div>
            </div>

            <!-- Study Room Scene -->
            <div class="scene study-bg" id="study">
                <div class="scene-description">
                    æ›¸æˆ¿ - è±¬è±¬çš„å·¥ä½œç©ºé–“
                </div>
                <div class="scene-content">
                    <div class="clickable-item" id="computer" style="top: 30%; left: 50%; transform: translateX(-50%); font-size: 5em;">
                        ğŸ’»
                    </div>
                    <div class="clickable-item" id="desk-drawer" style="top: 60%; left: 30%; font-size: 3.5em;">
                        ğŸ“‚
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeScene('bedroom')">å›åˆ°è‡¥å®¤</button>
                </div>
            </div>

            <!-- Kitchen Scene -->
            <div class="scene kitchen-bg" id="kitchen">
                <div class="scene-description">
                    å»šæˆ¿ - é€™è£¡æœ‰çŠçŠæœ€æ„›çš„èŒ¶è‘‰è§’è½
                </div>
                <div class="scene-content">
                    <div class="clickable-item highlight" id="fridge" style="top: 25%; left: 20%; font-size: 4em;">
                        ğŸ§Š
                    </div>
                    <div class="clickable-item" id="safe" style="top: 25%; right: 15%; font-size: 3.5em;">
                        ğŸ”
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeScene('living-room')">å›åˆ°å®¢å»³</button>
                </div>
            </div>
        </div>

        <div class="inventory">
            <div class="inventory-header">
                <span>èƒŒåŒ… (é»æ“Šç‰©å“é¸æ“‡/å–æ¶ˆ)</span>
                <button class="view-item-btn" id="view-item-btn" onclick="viewSelectedItem()" disabled>æŸ¥çœ‹è©³æƒ…</button>
            </div>
            <div class="inventory-items" id="inventory-items">
                <!-- Items will be added here -->
            </div>
        </div>
    </div>

    <!-- Modal for items and interactions -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modal-content">
            <!-- Dynamic content -->
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            inventory: [],
            selectedItem: null,
            foundClues: {
                firstThree: false,
                lastThree: false
            },
            flags: {
                // Living room
                hasKey: false,
                hasOldPhone: false,
                phoneCharged: false,

                // Bedroom
                wardrobeUnlocked: false,
                hasUSB: false,
                hasPhotoFrame: false,
                hasCharger: false,

                // Study
                computerUnlocked: false,
                hasWeddingPhoto: false,

                // Kitchen
                hasNote: false,
                safeUnlocked: false,
                hasFBScreenshot: false,

                // Final
                boxUnlocked: false
            }
        };

        // Items database
        const items = {
            key: { emoji: 'ğŸ”‘', name: 'é‘°åŒ™', description: 'ä¸€æŠŠå°å·§çš„é‘°åŒ™,çœ‹èµ·ä¾†å¯ä»¥é–‹æŸå€‹æ«ƒå­' },
            usb: { emoji: 'ğŸ’¾', name: 'USBéš¨èº«ç¢Ÿ', description: 'ä¸€å€‹ç²‰è‰²çš„USBéš¨èº«ç¢Ÿ,çœ‹èµ·ä¾†å¾ˆé‡è¦<br><span style="color: #666; font-size: 0.9em;">ä¹Ÿè¨±å¯ä»¥æ’åœ¨é›»è…¦ä¸Šçœ‹çœ‹å…§å®¹</span>' },
            photoFrame: { emoji: 'ğŸ–¼ï¸', name: 'ç›¸æ¡†ç´™æ¢', description: 'ç›¸æ¡†èƒŒå¾Œçš„ç´™æ¢å¯«è‘—:<br>"æˆ‘å€‘çš„çµå©šç´€å¿µæ—¥: 12æœˆ3æ—¥"<br><span style="color: #ff6b9d; font-weight: bold;">æ•¸å­—: 1203</span>' },
            weddingPhoto: { emoji: 'ğŸ’’', name: 'çµå©šç…§', description: 'çŠçŠå’Œè±¬è±¬çš„çµå©šç…§ç‰‡<br><span style="color: #ff6b9d; font-weight: bold;">èƒŒé¢å¯«è‘—: 123</span>' },
            oldPhone: { emoji: 'ğŸ“±', name: 'èˆŠæ‰‹æ©Ÿ', description: 'è±¬è±¬çš„èˆŠæ‰‹æ©Ÿ,é›»æ± æ²’é›»äº†<br><span style="color: #666; font-size: 0.9em;">éœ€è¦å……é›»å™¨æ‰èƒ½é–‹æ©Ÿ</span>' },
            charger: { emoji: 'ğŸ”Œ', name: 'å……é›»å™¨', description: 'æ‰‹æ©Ÿå……é›»å™¨,å¯ä»¥çµ¦èˆŠæ‰‹æ©Ÿå……é›»' },
            note: { emoji: 'ğŸ“', name: 'ä¾¿æ¢ç´™', description: 'è±¬è±¬çš„å­—è·¡:<br>"å›æ†¶ä¿å­˜åœ¨èˆŠæ‰‹æ©Ÿç•¶ä¸­"<br><span style="color: #666; font-size: 0.9em;">ä¹Ÿè¨±å®¢å»³æœ‰èˆŠæ‰‹æ©Ÿ?</span>' },
            fbScreenshot: { emoji: 'ğŸ’¬', name: 'FBæˆªåœ–', description: 'æ‰‹æ©Ÿç›¸ç°¿ä¸­çš„Facebookæˆªåœ–<br>é¡¯ç¤º2013å¹´9æœˆ19æ—¥çš„å°è©±è¨˜éŒ„<br><span style="color: #ff6b9d; font-weight: bold;">æ—¥æœŸ: 919</span>' }
        };

        // Initialize
        function init() {
            updateInventory();
        }

        // Start game - hide intro screen
        function startGame() {
            const introScreen = document.getElementById('intro-screen');
            introScreen.style.animation = 'fadeOut 0.5s ease-out';
            setTimeout(() => {
                introScreen.classList.add('hidden');
            }, 500);
        }

        // Scene management
        function changeScene(sceneName) {
            document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
            document.getElementById(sceneName).classList.add('active');
        }

        // Notification system
        function showNotification(message, isError = false) {
            const notif = document.getElementById('notification');
            notif.textContent = message;

            // Remove any existing classes
            notif.classList.remove('error');

            // Add error class if needed
            if (isError) {
                notif.classList.add('error');
            }

            notif.classList.add('show');
            setTimeout(() => {
                notif.classList.remove('show');
            }, 2000);
        }

        // Inventory management
        function addToInventory(itemKey) {
            if (!gameState.inventory.includes(itemKey)) {
                gameState.inventory.push(itemKey);
                updateInventory();
                showNotification(`ç²å¾—: ${items[itemKey].name}`);
            }
        }

        function updateInventory() {
            const inventoryItemsEl = document.getElementById('inventory-items');
            const viewBtnEl = document.getElementById('view-item-btn');
            inventoryItemsEl.innerHTML = '';

            if (gameState.inventory.length === 0) {
                inventoryItemsEl.innerHTML = '<div style="color: #95a5a6; font-size: 0.9em;">èƒŒåŒ…æ˜¯ç©ºçš„</div>';
            }

            gameState.inventory.forEach(itemKey => {
                const item = items[itemKey];
                const itemEl = document.createElement('div');
                itemEl.className = 'inventory-item';
                if (gameState.selectedItem === itemKey) {
                    itemEl.classList.add('selected');
                }
                itemEl.textContent = item.emoji;
                itemEl.onclick = () => selectItem(itemKey);
                inventoryItemsEl.appendChild(itemEl);
            });

            // Update view button state
            if (gameState.selectedItem) {
                viewBtnEl.disabled = false;
            } else {
                viewBtnEl.disabled = true;
            }
        }

        function selectItem(itemKey) {
            if (gameState.selectedItem === itemKey) {
                gameState.selectedItem = null;
                showNotification('å·²å–æ¶ˆé¸æ“‡');
            } else {
                gameState.selectedItem = itemKey;
                showNotification(`å·²é¸æ“‡: ${items[itemKey].name}`);
            }
            updateInventory();
        }

        function viewSelectedItem() {
            if (gameState.selectedItem) {
                viewItemDetails(gameState.selectedItem);
            }
        }

        // Modal system
        function showModal(content) {
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            gameState.selectedItem = null;
            updateInventory();
        }

        // Click handlers for items in scenes
        document.getElementById('bookshelf').onclick = function() {
            if (!gameState.flags.hasKey) {
                showModal(`
                    <div class="item-visual">ğŸ“š</div>
                    <h2>æ›¸æ¶</h2>
                    <p>ä½ ä»”ç´°ç¿»æ‰¾æ›¸æ¶,åœ¨ä¸€æœ¬ç›¸ç°¿å¾Œé¢ç™¼ç¾äº†ä¸€æŠŠé‘°åŒ™!</p>
                    <button class="close-btn" onclick="collectKey()">æ‹¿å–é‘°åŒ™</button>
                `);
            } else {
                showModal(`
                    <div class="item-visual">ğŸ“š</div>
                    <h2>æ›¸æ¶</h2>
                    <p>é€™è£¡å·²ç¶“æ²’æœ‰å…¶ä»–æ±è¥¿äº†</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        function collectKey() {
            gameState.flags.hasKey = true;
            addToInventory('key');
            closeModal();
            document.getElementById('bookshelf').classList.remove('highlight');
        }

        // ===== LIVING ROOM INTERACTIONS =====
        // TV Cabinet - Old phone (needs note first)
        document.getElementById('tv-cabinet').onclick = function() {
            if (!gameState.flags.hasNote) {
                // Before getting the note
                showModal(`
                    <div class="item-visual">ğŸ“º</div>
                    <h2>é›»è¦–æ«ƒ</h2>
                    <p>ä½ æ‰“é–‹é›»è¦–æ«ƒçš„æŠ½å±œ,è£¡é¢æœ‰ä¸€å †é›»è¦–é™æ§å’ŒèˆŠæ‰‹æ©Ÿ</p>
                    <p class="hint-text">çœ‹èµ·ä¾†æ²’ä»€éº¼ç‰¹åˆ¥çš„...</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else if (!gameState.flags.hasOldPhone) {
                // After getting the note, can pick up phone
                gameState.flags.hasOldPhone = true;
                addToInventory('oldPhone');
                closeModal();
                showModal(`
                    <div class="item-visual">ğŸ“º</div>
                    <h2>é›»è¦–æ«ƒ</h2>
                    <p>çœ‹åˆ°ä¾¿æ¢ç´™ä¸Šçš„æç¤º,ä½ æƒ³èµ·é€™è£¡æœ‰è±¬è±¬çš„èˆŠæ‰‹æ©Ÿ!</p>
                    <p>æ‰¾åˆ°äº†èˆŠæ‰‹æ©Ÿ!</p>
                    <p class="hint-text">æ‰‹æ©Ÿæ²’é›»äº†,éœ€è¦æ‰¾åˆ°å……é›»å™¨</p>
                    <button class="close-btn" onclick="closeModalAndCheckPhone()">é—œé–‰</button>
                `);
            } else {
                showModal(`
                    <div class="item-visual">ğŸ“º</div>
                    <h2>é›»è¦–æ«ƒ</h2>
                    <p>æ«ƒå­è£¡åªå‰©ä¸‹ä¸€äº›é™æ§å™¨äº†</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        function closeModalAndCheckPhone() {
            closeModal();
            checkPhoneCharging();
        }

        // ===== BEDROOM INTERACTIONS =====
        // Wardrobe - needs key
        document.getElementById('wardrobe').onclick = function() {
            if (gameState.selectedItem === 'key' && !gameState.flags.wardrobeUnlocked) {
                gameState.flags.wardrobeUnlocked = true;
                gameState.flags.hasUSB = true;
                addToInventory('usb');
                closeModal();
                showModal(`
                    <div class="item-visual">ğŸšª</div>
                    <h2>è¡£æ«ƒ</h2>
                    <p>ä½ ç”¨é‘°åŒ™æ‰“é–‹äº†è¡£æ«ƒ,åœ¨è¡£æœå †è£¡æ‰¾åˆ°ä¸€å€‹USBéš¨èº«ç¢Ÿ!</p>
                    <p class="hint-text">ä¹Ÿè¨±å¯ä»¥ç”¨é›»è…¦è®€å–å…§å®¹?</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else if (gameState.flags.wardrobeUnlocked) {
                showModal(`
                    <div class="item-visual">ğŸšª</div>
                    <h2>è¡£æ«ƒ</h2>
                    <p>è¡£æ«ƒè£¡åªå‰©ä¸‹è¡£æœäº†</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else {
                showModal(`
                    <div class="item-visual">ğŸšª</div>
                    <h2>ä¸Šé–çš„è¡£æ«ƒ</h2>
                    <p>è¡£æ«ƒéœ€è¦é‘°åŒ™æ‰èƒ½æ‰“é–‹</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        // Bedside table - charger
        document.getElementById('bedside-table').onclick = function() {
            if (!gameState.flags.hasCharger) {
                gameState.flags.hasCharger = true;
                addToInventory('charger');
                closeModal();
                showModal(`
                    <div class="item-visual">ğŸ›ï¸</div>
                    <h2>åºŠé ­æ«ƒ</h2>
                    <p>ä½ åœ¨åºŠé ­æ«ƒçš„æŠ½å±œè£¡æ‰¾åˆ°äº†æ‰‹æ©Ÿå……é›»å™¨!</p>
                    <button class="close-btn" onclick="closeModalAndCheckPhone()">é—œé–‰</button>
                `);
            } else {
                showModal(`
                    <div class="item-visual">ğŸ›ï¸</div>
                    <h2>åºŠé ­æ«ƒ</h2>
                    <p>æŠ½å±œå·²ç¶“æ˜¯ç©ºçš„äº†</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        // Photo frame - hint for computer password
        document.getElementById('photo-frame').onclick = function() {
            if (!gameState.flags.hasPhotoFrame) {
                gameState.flags.hasPhotoFrame = true;
                addToInventory('photoFrame');
                closeModal();
                showModal(`
                    <div class="item-visual">ğŸ–¼ï¸</div>
                    <h2>ç›¸æ¡†</h2>
                    <p>ä½ æ‹¿èµ·ç›¸æ¡†,ç™¼ç¾èƒŒå¾Œè²¼è‘—ä¸€å¼µå°ç´™æ¢!</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else {
                showModal(`
                    <div class="item-visual">ğŸ–¼ï¸</div>
                    <h2>ç›¸æ¡†</h2>
                    <p>åªæ˜¯æ™®é€šçš„ç›¸æ¡†</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        // ===== STUDY ROOM INTERACTIONS =====
        // Computer - needs USB and password
        document.getElementById('computer').onclick = function() {
            if (gameState.flags.computerUnlocked && gameState.flags.hasWeddingPhoto) {
                showModal(`
                    <div class="item-visual">ğŸ’»</div>
                    <h2>é›»è…¦</h2>
                    <p>é›»è…¦è¢å¹•é¡¯ç¤ºè‘—å‰›æ‰è§£é–çš„çµå©šç…§ç‰‡</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else if (gameState.selectedItem === 'usb' && !gameState.flags.computerUnlocked) {
                showModal(`
                    <div class="item-visual">ğŸ’»</div>
                    <h2>é›»è…¦</h2>
                    <p>ä½ æŠŠUSBæ’å…¥é›»è…¦,ç™¼ç¾æª”æ¡ˆè¢«åŠ å¯†äº†!</p>
                    <p>éœ€è¦4ä½æ•¸å­—å¯†ç¢¼</p>
                    <div class="password-input">
                        <input type="number" maxlength="1" id="comp-1" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="comp-2" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="comp-3" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="comp-4" oninput="this.value=this.value.slice(0,1)">
                    </div>
                    <button class="submit-btn" onclick="checkComputerPassword()">ç¢ºèª</button>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                    <p class="hint-text">æç¤º: è©¦è‘—æ‰¾æ‰¾çœ‹è‡¥å®¤è£¡çš„ç·šç´¢</p>
                `);
            } else if (gameState.flags.computerUnlocked) {
                showModal(`
                    <div class="item-visual">ğŸ’»</div>
                    <h2>é›»è…¦</h2>
                    <p>é›»è…¦å·²ç¶“è§£é–éäº†</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else {
                showModal(`
                    <div class="item-visual">ğŸ’»</div>
                    <h2>é›»è…¦</h2>
                    <p>è±¬è±¬çš„å·¥ä½œé›»è…¦</p>
                    <p class="hint-text">ä¹Ÿè¨±éœ€è¦USBéš¨èº«ç¢Ÿ?</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        function checkComputerPassword() {
            const password =
                document.getElementById('comp-1').value +
                document.getElementById('comp-2').value +
                document.getElementById('comp-3').value +
                document.getElementById('comp-4').value;

            if (password === '1203') {
                gameState.flags.computerUnlocked = true;
                gameState.flags.hasWeddingPhoto = true;
                gameState.foundClues.firstThree = true;
                addToInventory('weddingPhoto');
                closeModal();
                showModal(`
                    <div class="item-visual">ğŸ”“</div>
                    <h2>æˆåŠŸè§£é–!</h2>
                    <p>æª”æ¡ˆè§£å¯†äº†!æ˜¯ä½ å€‘çš„çµå©šç…§ç‰‡!</p>
                    <p style="color: #4CAF50; font-weight: bold;">âœ“ ç²å¾—å‰3ä½å¯†ç¢¼!</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else {
                showNotification('å¯†ç¢¼éŒ¯èª¤!', true);
            }
        }

        // Desk drawer - empty for now
        document.getElementById('desk-drawer').onclick = function() {
            showModal(`
                <div class="item-visual">ğŸ“‚</div>
                <h2>æ›¸æ¡ŒæŠ½å±œ</h2>
                <p>æŠ½å±œè£¡åªæœ‰ä¸€äº›æ–‡ä»¶å’Œæ–‡å…·</p>
                <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
            `);
        };

        // ===== KITCHEN INTERACTIONS =====
        document.getElementById('fridge').onclick = function() {
            if (!gameState.flags.hasNote) {
                gameState.flags.hasNote = true;
                addToInventory('note');
                closeModal();
                showModal(`
                    <div class="item-visual">ğŸ§Š</div>
                    <h2>å†°ç®±</h2>
                    <p>ä½ æ‰“é–‹å†°ç®±,åœ¨é–€ä¸Šç™¼ç¾ä¸€å¼µä¾¿æ¢ç´™!</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
                document.getElementById('fridge').classList.remove('highlight');
            } else {
                showModal(`
                    <div class="item-visual">ğŸ§Š</div>
                    <h2>å†°ç®±</h2>
                    <p>å†°ç®±è£¡åªæœ‰é£Ÿæå’Œé£²æ–™</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        // Auto-charge phone when both items are in inventory
        function checkPhoneCharging() {
            if (gameState.flags.hasOldPhone && gameState.flags.hasCharger && !gameState.flags.phoneCharged) {
                gameState.flags.phoneCharged = true;

                // Show charging notification
                setTimeout(() => {
                    showModal(`
                        <div class="item-visual">ğŸ”ŒğŸ“±</div>
                        <h2>æ‰‹æ©Ÿè‡ªå‹•å……é›»!</h2>
                        <p>ä½ æœ‰äº†å……é›»å™¨å’ŒèˆŠæ‰‹æ©Ÿ,æ‰‹æ©Ÿè‡ªå‹•é–‹æ©Ÿäº†!</p>
                        <p>æŸ¥çœ‹ç›¸ç°¿,ç™¼ç¾äº†ä¸€å¼µFacebookæˆªåœ–!</p>
                        <button class="close-btn" onclick="unlockPhonePhotos()">æŸ¥çœ‹ç…§ç‰‡</button>
                    `);
                }, 500);
            }
        }

        function unlockPhonePhotos() {
            gameState.flags.hasFBScreenshot = true;
            gameState.foundClues.lastThree = true;
            addToInventory('fbScreenshot');
            closeModal();
            showNotification('âœ“ ç²å¾—å¾Œ3ä½å¯†ç¢¼!');
        }

        // Safe - final confirmation (optional)
        document.getElementById('safe').onclick = function() {
            if (gameState.flags.hasFBScreenshot) {
                showModal(`
                    <div class="item-visual">ğŸ”</div>
                    <h2>ä¿éšªç®±</h2>
                    <p>é€™å€‹ä¿éšªç®±éœ€è¦3ä½æ•¸å­—å¯†ç¢¼</p>
                    <div class="password-input">
                        <input type="number" maxlength="1" id="safe-1" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="safe-2" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="safe-3" oninput="this.value=this.value.slice(0,1)">
                    </div>
                    <button class="submit-btn" onclick="checkSafePassword()">ç¢ºèª</button>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                    <p class="hint-text">æç¤º: æŸ¥çœ‹FBæˆªåœ–çš„æ—¥æœŸ</p>
                `);
            } else if (!gameState.flags.safeUnlocked) {
                showModal(`
                    <div class="item-visual">ğŸ”</div>
                    <h2>ä¿éšªç®±</h2>
                    <p>é€™å€‹ä¿éšªç®±éœ€è¦3ä½æ•¸å­—å¯†ç¢¼</p>
                    <p class="hint-text">å…ˆæ‰¾åˆ°ç·šç´¢å†ä¾†å§</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else {
                showModal(`
                    <div class="item-visual">ğŸ”</div>
                    <h2>ä¿éšªç®±</h2>
                    <p>ä¿éšªç®±å·²ç¶“æ‰“é–‹éäº†</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        function checkSafePassword() {
            const d1 = document.getElementById('safe-1').value;
            const d2 = document.getElementById('safe-2').value;
            const d3 = document.getElementById('safe-3').value;
            const password = d1 + d2 + d3;

            if (password === '919') {
                gameState.flags.safeUnlocked = true;
                closeModal();
                showModal(`
                    <div class="item-visual">ğŸ”“</div>
                    <h2>æ­£ç¢º!</h2>
                    <p>ä¿éšªç®±æ‰“é–‹äº†!è£¡é¢æœ‰ä¸€å°ä¿¡:</p>
                    <p style="font-style: italic; color: #666; margin-top: 15px;">
                        "è¦ªæ„›çš„çŠçŠ,<br>
                        å¦‚æœä½ æ‰“é–‹äº†é€™å€‹ä¿éšªç®±,<br>
                        ä»£è¡¨ä½ å·²ç¶“æ‰¾åˆ°äº†æ‰€æœ‰ç·šç´¢!<br>
                        ç¾åœ¨å¯ä»¥å»æ‰“é–‹é‚£å€‹ç¥ç§˜ç›’å­äº† ğŸ’•"
                    </p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else {
                showNotification('å¯†ç¢¼éŒ¯èª¤!', true);
            }
        }

        document.getElementById('mystery-box').onclick = function() {
            if (gameState.flags.boxUnlocked) {
                showVictory();
            } else if (gameState.foundClues.firstThree && gameState.foundClues.lastThree) {
                showModal(`
                    <div class="item-visual">ğŸ“¦</div>
                    <h2>ç¥ç§˜ç›’å­</h2>
                    <p>ä½ å·²ç¶“æ”¶é›†åˆ°æ‰€æœ‰ç·šç´¢äº†!</p>
                    <p>è«‹è¼¸å…¥6ä½æ•¸å­—å¯†ç¢¼:</p>
                    <div class="password-input">
                        <input type="number" maxlength="1" id="box-1" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="box-2" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="box-3" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="box-4" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="box-5" oninput="this.value=this.value.slice(0,1)">
                        <input type="number" maxlength="1" id="box-6" oninput="this.value=this.value.slice(0,1)">
                    </div>
                    <button class="submit-btn" onclick="checkBoxPassword()">é–‹å•Ÿç›’å­</button>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            } else {
                let hint = '';
                if (!gameState.foundClues.firstThree) {
                    hint = 'ä½ éœ€è¦å…ˆæ‰¾åˆ°å¯†ç¢¼çš„æç¤º';
                } else if (!gameState.foundClues.lastThree) {
                    hint = 'ä½ éœ€è¦å…ˆæ‰¾åˆ°å¯†ç¢¼çš„æç¤º';
                }
                showModal(`
                    <div class="item-visual">ğŸ“¦</div>
                    <h2>ç¥ç§˜ç›’å­</h2>
                    <p>é€™å€‹ç›’å­éœ€è¦6ä½æ•¸å­—å¯†ç¢¼æ‰èƒ½æ‰“é–‹</p>
                    <p class="hint-text">${hint}</p>
                    <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
                `);
            }
        };

        function checkBoxPassword() {
            const password =
                document.getElementById('box-1').value +
                document.getElementById('box-2').value +
                document.getElementById('box-3').value +
                document.getElementById('box-4').value +
                document.getElementById('box-5').value +
                document.getElementById('box-6').value;

            if (password === '123919') {
                gameState.flags.boxUnlocked = true;
                closeModal();
                showVictory();
            } else {
                showNotification('å¯†ç¢¼éŒ¯èª¤! å†è©¦ä¸€æ¬¡', true);
            }
        }

        function showVictory() {
            // Play music
            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBCR1xvDTgjMGHm7A7OShUhELTKXh8LljHAU2jdXxxHAlBSh+zPLaizsIGGS57OihUREKTKPi8bllHQU3j9bxxXEmBSh9y/HWhzsIGWW67+mjUxEKTKXh8LhjHAU2jdXxxHAlBSh9y/HWhzsIGWW67+mjUxEKTKXh8LhjHAU2jdXxxHAlBSh9y/HWhzsIGWW67+mjUxEKTKXh8LhjHAU2jdXxxHAlBSh9y/HWhzsIGWS57OmjUhEKTKXh8LhjGwU2jdXxxHAmBSh9y/HWhzsIGWS57OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS57OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS57OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS57OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS57OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS57OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLbizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREKTKXh8LhjHAU2jdXxxHAlBSh+zPLaizsIGWS47OmjUREK');
            audio.play().catch(() => {
                // If audio fails to play, continue anyway
            });

            showModal(`
                <div class="victory">
                    <h1>ğŸ‰ æ­å–œ! ğŸ‰</h1>
                    <div class="birthday-card">
                        <h2>è¦ªæ„›çš„çŠçŠ:</h2>
                        <p>
                            ç”Ÿæ—¥å¿«æ¨‚! â¤ï¸<br><br>
                            è¬è¬å¦³ä¸€ç›´ä»¥ä¾†çš„é™ªä¼´,<br>
                            æ¯ä¸€å¤©å’Œå¦³åœ¨ä¸€èµ·éƒ½æ˜¯æœ€ç¾å¥½çš„æ™‚å…‰ã€‚<br><br>
                            123 æ˜¯æˆ‘å€‘çš„çµå©šæ—¥å­ (12æœˆ3æ—¥)<br>
                            919 æ˜¯æˆ‘å€‘åœ¨Facebookç›¸è­˜çš„æ—¥å­ (9æœˆ19æ—¥)<br><br>
                            é€™äº›æ—¥å­æˆ‘éƒ½è¨˜å¾—,<br>
                            å› ç‚ºå®ƒå€‘å°æˆ‘ä¾†èªªéƒ½å¾ˆé‡è¦ã€‚<br><br>
                            å¸Œæœ›é€™å€‹å°éŠæˆ²èƒ½ç‚ºå¦³çš„ç”Ÿæ—¥å¢æ·»ä¸€äº›é©šå–œ!<br><br>
                            æ°¸é æ„›å¦³çš„,<br>
                            è±¬è±¬ ğŸ’•
                        </p>
                    </div>
                    <p style="font-size: 0.9em; color: #666;">éŠæˆ²å®Œæˆæ™‚é–“: ${new Date().toLocaleString('zh-TW')}</p>
                    <button class="close-btn" onclick="location.reload()">é‡æ–°é–‹å§‹</button>
                </div>
            `);
        }

        // Allow viewing item details
        function viewItemDetails(itemKey) {
            const item = items[itemKey];
            showModal(`
                <div class="item-visual">${item.emoji}</div>
                <h2>${item.name}</h2>
                <p>${item.description}</p>
                <button class="close-btn" onclick="closeModal()">é—œé–‰</button>
            `);
        }

        // Initialize game
        init();
    </script>
</body>
</html>